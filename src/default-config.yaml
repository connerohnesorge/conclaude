# Conclaude Configuration Template
#
# This is a minimal example configuration file.
# For full documentation of all options, run: conclaude config --docs
# Or see the generated documentation from `cargo doc --open`

# Stop hook - runs when Claude is about to stop
stop:
  commands: []
  # Shell command examples:
  # - run: "npm test"
  #   showStdout: true
  #   showStderr: true
  #   showCommand: true  # Show "Executing command X/Y: npm test" (default: true)
  #   message: "Tests failed"
  #   maxOutputLines: 100
  #   timeout: 300
  #
  # Rg (ripgrep) command examples:
  #
  # Block if any TODO or FIXME comments exist
  # - rg:
  #     pattern: "TODO|FIXME"
  #     files: "**/*.rs"
  #   message: "Found TODO/FIXME comments. Please address them before stopping."
  #   action: block
  #
  # Require at least one test function in the codebase
  # - rg:
  #     pattern: "#\\[test\\]"
  #     files: "**/*.rs"
  #     min: 1
  #   message: "No test functions found. Please add tests."
  #
  # Block inline CSS classes in HTML files
  # - rg:
  #     pattern: "class=.*(?:bg-|text-|p-|m-)"
  #     files: "**/*.html"
  #     ignoreCase: true
  #   message: "Found inline Tailwind classes. Use CSS modules instead."
  #   action: warn  # Just warn, don't block
  #
  # Ensure no console.log statements in production code
  # - rg:
  #     pattern: "console\\.log"
  #     files: "**/*.{ts,tsx,js,jsx}"
  #     types:
  #       - js
  #       - ts
  #   message: "Found console.log statements. Please remove them."
  #
  # Check for hardcoded secrets (case-insensitive)
  # - rg:
  #     pattern: "(password|api[_-]?key|secret|token)\\s*=\\s*['\"][^'\"]{8,}"
  #     files: "**/*.{ts,js,py,rs}"
  #     ignoreCase: true
  #     max: 0
  #   message: "Found potential hardcoded secrets. Use environment variables."
  #
  # Require error handling in async functions
  # - rg:
  #     pattern: "async\\s+function.*\\{[^}]*await[^}]*\\}"
  #     files: "**/*.ts"
  #     multiLine: true
  #     dotMatchesNewLine: true
  #   message: "Async functions should have error handling"
  #   action: warn
  #
  # Rg Options Reference:
  #
  # Required fields:
  #   pattern: string    - Regex pattern to search for
  #   files: string      - Glob pattern for files (e.g., "**/*.rs")
  #
  # Constraint fields (mutually exclusive):
  #   max: number        - Maximum allowed matches (default: 0 when no constraint specified)
  #   min: number        - Minimum required matches
  #   equal: number      - Exact match count required
  #
  # Regex options:
  #   ignoreCase: bool   - Case insensitive (default: false)
  #   smartCase: bool    - Auto-detect case sensitivity (default: false)
  #   word: bool         - Word boundary matching (default: false)
  #   fixedStrings: bool - Treat pattern as literal (default: false)
  #   multiLine: bool    - Multiline mode (default: false)
  #   wholeLine: bool    - Match entire line only (default: false)
  #   dotMatchesNewLine: bool - Dot matches newline (default: false)
  #   unicode: bool      - Unicode support (default: true)
  #
  # File walking options:
  #   maxDepth: number   - Max directory depth
  #   hidden: bool       - Include hidden files (default: false)
  #   followLinks: bool  - Follow symlinks (default: false)
  #   maxFilesize: number - Skip files larger than N bytes
  #   gitIgnore: bool    - Respect .gitignore (default: true)
  #   rgIgnore: bool     - Respect .ignore files (default: true)
  #   parents: bool      - Read parent ignore files (default: true)
  #   sameFileSystem: bool - Don't cross filesystems (default: false)
  #   threads: number    - Parallel search threads
  #   types: [string]    - File type filters (e.g., ["rust", "js"])
  #
  # Search options:
  #   context: number    - Lines of context (default: 0)
  #   countMode: string  - "lines" or "occurrences" (default: "lines")
  #   invertMatch: bool  - Invert match (default: false)
  #
  # Command options (shared with shell commands):
  #   action: string     - "block" or "warn" (default: "block")
  #   message: string    - Custom error message
  #   showStdout: bool   - Show output (default: false)
  #   showStderr: bool   - Show errors (default: false)
  #   showCommand: bool  - Show "Executing command X/Y" (default: true)
  #   maxOutputLines: number - Limit output lines (range: 1-10000)
  #   timeout: number    - Timeout in seconds (range: 1-3600)
  #   notifyPerCommand: bool - Per-command notifications (default: false)

  infinite: false
  infiniteMessage: "continue working on the task"

# Subagent stop hook - runs when subagents finish
subagentStop:
  commands: {}
  # Shell command examples:
  # coder:
  #   - run: "npm run lint"
  #     showStdout: true
  #     showCommand: true  # Show "Executing command X/Y: npm run lint" (default: true)
  #     message: "Linting failed"
  # test*:
  #   - run: "npm test"
  #     showStderr: true
  #     showCommand: false  # Hide the "Executing command..." line
  #
  # Rg command examples:
  #
  # Run for all agents - check for leftover debug code
  # "*":
  #   - rg:
  #       pattern: "debugger|console\\.log"
  #       files: "**/*.{ts,tsx,js,jsx}"
  #     action: warn
  #     message: "Debug statements found in code"
  #
  # For coder agent - verify tests exist for changes
  # coder:
  #   - rg:
  #       pattern: "test_|#\\[test\\]"
  #       files: "**/*.rs"
  #       min: 1
  #     message: "Coder should ensure tests exist"
  #
  #   # Check for unwrap() calls in Rust code
  #   - rg:
  #       pattern: "\\.unwrap\\(\\)"
  #       files: "**/*.rs"
  #       max: 0
  #     message: "Use proper error handling instead of unwrap()"
  #     action: warn
  #
  # For tester agent - ensure test coverage markers exist
  # tester:
  #   - rg:
  #       pattern: "#\\[cfg\\(test\\)\\]"
  #       files: "**/*.rs"
  #       min: 1
  #     message: "No test modules found"
  #
  # Multiple patterns for different agents
  # "doc*":
  #   # Ensure documentation has code examples
  #   - rg:
  #       pattern: "```"
  #       files: "**/*.md"
  #       min: 1
  #     message: "Documentation should include code examples"
  #     action: warn

# Pre-tool-use hook - file protection and tool validation
preToolUse:
  # Prevent files at repository root
  preventRootAdditions: true
  # Custom message for root additions block (supports {file_path} and {tool} placeholders)
  # Example: "Files must go in src/. Cannot create {file_path} using {tool}."
  preventRootAdditionsMessage: null

  # Protected files (glob patterns)
  uneditableFiles:
    - ".conclaude.yml"
    - ".conclaude.yaml"
  # Examples:
  # - "*.lock"
  # - pattern: ".env*"
  #   message: "Environment files contain secrets"
  #
  # Agent-specific protection examples (blocks specific subagents):
  # - pattern: "spectr/changes/**/tasks.jsonc"
  #   message: "Task files managed by orchestrator"
  #   agent: "coder"  # Only blocks coder subagent
  #
  # - pattern: "src/**/*.test.ts"
  #   message: "Test files managed by tester agent"
  #   agent: "code*"  # Blocks coder, coder-v2, etc.
  #
  # - pattern: "docs/**"
  #   agent: "*"  # Blocks all agents (same as omitting agent field)

  # Prevent editing git-ignored files
  preventUpdateGitIgnored: false

  # Tool usage rules
  toolUsageValidation: []
  # Example:
  # - tool: "Write"
  #   pattern: "**/*.js"
  #   action: "allow"
  # - tool: "Bash"
  #   commandPattern: "git push --force*"
  #   action: "block"
  #   message: "Force push not allowed"
  #
  # Agent-scoped rules (only apply to specific agents):
  # - tool: "Bash"
  #   pattern: ""
  #   commandPattern: "rm -rf *"
  #   action: "block"
  #   agent: "coder"
  #   message: "Coder agent cannot run destructive rm commands"
  # - tool: "Write"
  #   pattern: "**/*.test.ts"
  #   action: "block"
  #   agent: "coder"
  #   message: "Coder agent should not modify test files"
  # - tool: "*"
  #   pattern: "src/**"
  #   action: "block"
  #   agent: "test*"
  #   message: "Test agents cannot modify source files"
  #
  # Agent pattern examples:
  #   - agent: "coder"    # Exact match - only "coder" subagent
  #   - agent: "test*"    # Glob pattern - matches "tester", "test-runner"
  #   - agent: "*"        # Wildcard - matches all agents (default if omitted)

  # Directories where additions are prevented
  preventAdditions: []
  # Example: ["dist", "build"]

# System notifications
notifications:
  enabled: false
  hooks: []  # ["*"] for all, or ["Stop", "PreToolUse"]
  showErrors: false
  showSuccess: false
  showSystemEvents: true

# Permission request hook - auto-approve/deny tools
# Uncomment to enable:
#
# permissionRequest:
#   default: deny  # "allow" or "deny"
#   allow:
#     - "Read"
#     - "Glob"
#     - "Grep"
#     - "Edit"
#     - "Write"
#   deny:
#     - "BashOutput"
#     - "KillShell"

# User prompt submit hook - context injection and command execution
# Automatically prepends context when prompts match patterns
# Uncomment to enable:
#
# userPromptSubmit:
#   contextRules:
#     # Pattern-based context injection
#     - pattern: "sidebar"
#       prompt: |
#         Make sure to read @.claude/contexts/sidebar.md before proceeding.
#
#     # Multiple patterns with regex alternation
#     - pattern: "auth|login|authentication"
#       prompt: |
#         Review the authentication patterns in @.claude/contexts/auth.md
#
#     # Case-insensitive matching (using regex flag)
#     - pattern: "(?i)database|sql|query"
#       prompt: |
#         Follow the database conventions in @.claude/contexts/database.md
#
#     # Disable a rule temporarily
#     - pattern: "test"
#       prompt: "Run tests before proceeding"
#       enabled: false
#
#     # Explicit case-insensitive flag
#     - pattern: "api"
#       prompt: "Check API documentation first"
#       caseInsensitive: true
#
#   # Command execution (runs after contextRules processing)
#   # Commands are observational - they cannot block prompt processing
#   commands:
#     # Run for all prompts (no pattern)
#     - run: ".claude/scripts/log-prompt.sh"
#       showCommand: false
#
#     # Run only for prompts matching pattern (regex)
#     - pattern: "deploy|release|ship"
#       run: ".claude/scripts/notify-slack.sh"
#       showCommand: false
#
#     # Run with output display options
#     - pattern: "(?i)sql|database"
#       run: ".claude/scripts/check-db-access.sh"
#       showStdout: true
#       timeout: 30
#
#   # Environment variables available to commands:
#   # - CONCLAUDE_USER_PROMPT: The user's input text
#   # - CONCLAUDE_SESSION_ID: Current session ID
#   # - CONCLAUDE_CWD: Current working directory
#   # - CONCLAUDE_CONFIG_DIR: Directory containing .conclaude.yaml
#   # - CONCLAUDE_HOOK_EVENT: Always "UserPromptSubmit"
